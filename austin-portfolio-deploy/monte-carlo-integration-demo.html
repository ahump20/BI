<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Monte Carlo Visualizer Demo - Blaze Sports Intelligence</title>

    <!-- Three.js Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r158/three.min.js"></script>

    <!-- Three.js Add-ons for Post-Processing -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/shaders/FXAAShader.js"></script>

    <!-- GSAP for Smooth Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <!-- Enhanced Monte Carlo Styles -->
    <link rel="stylesheet" href="monte-carlo-enhanced.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #001122 0%, #000000 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        .hero-section {
            padding: 60px 20px;
            text-align: center;
            background: linear-gradient(135deg, rgba(191, 87, 0, 0.1) 0%, rgba(155, 203, 235, 0.1) 100%);
        }

        .hero-title {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #BF5700 0%, #9BCBEB 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 32px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .visualizer-container {
            margin-bottom: 40px;
            position: relative;
        }

        .controls-panel {
            background: linear-gradient(135deg, rgba(0, 34, 68, 0.8) 0%, rgba(0, 0, 0, 0.8) 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid rgba(191, 87, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .control-group {
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(155, 203, 235, 0.2);
        }

        .control-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #9BCBEB;
            font-size: 14px;
        }

        .control-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(191, 87, 0, 0.3);
            border-radius: 6px;
            color: #ffffff;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
        }

        .control-input:focus {
            outline: none;
            border-color: #BF5700;
            box-shadow: 0 0 0 2px rgba(191, 87, 0, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, #BF5700 0%, #D16A00 100%);
            color: #ffffff;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
            font-size: 14px;
            margin: 4px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #D16A00 0%, #E37B00 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(191, 87, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4B92DB 0%, #5A9EE5 100%);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #5A9EE5 0%, #6AAAF0 100%);
            box-shadow: 0 8px 20px rgba(75, 146, 219, 0.4);
        }

        .team-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .team-btn {
            padding: 8px 16px;
            border: 2px solid;
            background: transparent;
            border-radius: 6px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
        }

        .team-btn.cardinals {
            border-color: #C21E26;
            color: #C21E26;
        }

        .team-btn.cardinals.active,
        .team-btn.cardinals:hover {
            background: #C21E26;
            color: #ffffff;
        }

        .team-btn.titans {
            border-color: #4B92DB;
            color: #4B92DB;
        }

        .team-btn.titans.active,
        .team-btn.titans:hover {
            background: #4B92DB;
            color: #ffffff;
        }

        .team-btn.longhorns {
            border-color: #BF5700;
            color: #BF5700;
        }

        .team-btn.longhorns.active,
        .team-btn.longhorns:hover {
            background: #BF5700;
            color: #ffffff;
        }

        .team-btn.grizzlies {
            border-color: #5D76A9;
            color: #5D76A9;
        }

        .team-btn.grizzlies.active,
        .team-btn.grizzlies:hover {
            background: #5D76A9;
            color: #ffffff;
        }

        .status-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            border: 1px solid rgba(155, 203, 235, 0.2);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .status-value {
            color: #BF5700;
            font-weight: 600;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 40px;
        }

        .feature-card {
            background: linear-gradient(135deg, rgba(0, 34, 68, 0.6) 0%, rgba(0, 0, 0, 0.6) 100%);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(191, 87, 0, 0.3);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            border-color: rgba(191, 87, 0, 0.6);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 16px;
        }

        .feature-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: #BF5700;
        }

        .feature-description {
            opacity: 0.8;
            line-height: 1.6;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .metric-card {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid rgba(155, 203, 235, 0.2);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #BF5700;
            font-family: 'JetBrains Mono', monospace;
        }

        .metric-label {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
            }

            .team-selector {
                justify-content: center;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero-section">
        <h1 class="hero-title">Enhanced Monte Carlo Visualizer</h1>
        <p class="hero-subtitle">
            GPU-accelerated 3D probability visualization with Deep South sports intelligence.
            Experience championship-grade analytics with 10,000+ interactive particles.
        </p>
    </section>

    <!-- Main Demo Container -->
    <div class="demo-container">
        <!-- Controls Panel -->
        <div class="controls-panel">
            <h3 style="margin-bottom: 20px; color: #BF5700; font-size: 1.4rem;">🎲 Interactive Controls</h3>

            <!-- Team Selection -->
            <div class="control-group">
                <label class="control-label">Select Team Theme:</label>
                <div class="team-selector">
                    <button class="team-btn cardinals active" data-team="cardinals">Cardinals</button>
                    <button class="team-btn titans" data-team="titans">Titans</button>
                    <button class="team-btn longhorns" data-team="longhorns">Longhorns</button>
                    <button class="team-btn grizzlies" data-team="grizzlies">Grizzlies</button>
                    <button class="team-btn" data-team="deepSouth" style="border-color: #9BCBEB; color: #9BCBEB;">Deep South</button>
                </div>
            </div>

            <!-- Simulation Controls -->
            <div class="controls-grid">
                <div class="control-group">
                    <label class="control-label" for="particleCount">Particle Count:</label>
                    <input type="range" id="particleCount" class="control-input" min="1000" max="20000" step="1000" value="10000">
                    <small style="color: #9BCBEB; margin-top: 4px; display: block;">Current: <span id="particleCountValue">10,000</span></small>
                </div>

                <div class="control-group">
                    <label class="control-label" for="simulationType">Simulation Type:</label>
                    <select id="simulationType" class="control-input">
                        <option value="season">Season Trajectory</option>
                        <option value="game">Game Outcome</option>
                        <option value="player">Player Performance</option>
                        <option value="championship">Championship Path</option>
                        <option value="custom">Custom Distribution</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for="confidenceLevel">Confidence Level:</label>
                    <select id="confidenceLevel" class="control-input">
                        <option value="0.95">95% Confidence</option>
                        <option value="0.90">90% Confidence</option>
                        <option value="0.80" selected>80% Confidence</option>
                        <option value="0.68">68% Confidence</option>
                    </select>
                </div>

                <div class="control-group">
                    <label class="control-label" for="animationSpeed">Animation Speed:</label>
                    <input type="range" id="animationSpeed" class="control-input" min="0.1" max="3.0" step="0.1" value="1.0">
                    <small style="color: #9BCBEB; margin-top: 4px; display: block;">Current: <span id="animationSpeedValue">1.0x</span></small>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="runSimulation()">🎲 Run Simulation</button>
                <button class="btn btn-secondary" onclick="toggleAutoRotate()">🔄 Toggle Rotation</button>
                <button class="btn btn-secondary" onclick="resetCamera()">📷 Reset Camera</button>
                <button class="btn btn-secondary" onclick="captureScreenshot()">📸 Screenshot</button>
                <button class="btn btn-secondary" onclick="exportData()">📊 Export Data</button>
            </div>
        </div>

        <!-- Monte Carlo Visualizer Container -->
        <div class="visualizer-container">
            <div id="mcProbabilityCloud">
                <div class="mc-visualizer-loading">
                    <div class="mc-loading-spinner"></div>
                    <div class="mc-loading-text">Initializing Enhanced Monte Carlo Visualizer...</div>
                </div>
            </div>
        </div>

        <!-- Status Panel -->
        <div class="status-panel">
            <h4 style="margin-bottom: 12px; color: #BF5700;">System Status</h4>
            <div class="status-item">
                <span>Device Tier:</span>
                <span class="status-value" id="deviceTier">Detecting...</span>
            </div>
            <div class="status-item">
                <span>WebGL 2.0:</span>
                <span class="status-value" id="webgl2Support">Checking...</span>
            </div>
            <div class="status-item">
                <span>Current FPS:</span>
                <span class="status-value" id="currentFPS">--</span>
            </div>
            <div class="status-item">
                <span>Active Particles:</span>
                <span class="status-value" id="activeParticles">--</span>
            </div>
            <div class="status-item">
                <span>Current Team:</span>
                <span class="status-value" id="currentTeam">Cardinals</span>
            </div>
            <div class="status-item">
                <span>Scenario:</span>
                <span class="status-value" id="currentScenario">Default</span>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value" id="metricSimulations">10,000</div>
                <div class="metric-label">Simulations</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metricConfidence">95%</div>
                <div class="metric-label">Confidence</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metricProcessingTime">--</div>
                <div class="metric-label">Processing Time (ms)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="metricMemoryUsage">--</div>
                <div class="metric-label">Memory Usage (MB)</div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🚀</div>
                <h3 class="feature-title">GPU Acceleration</h3>
                <p class="feature-description">
                    Advanced WebGL shaders with up to 20,000 particles running at 60fps.
                    Automatic performance adaptation based on device capabilities.
                </p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">🏆</div>
                <h3 class="feature-title">Deep South Sports</h3>
                <p class="feature-description">
                    Team-specific color schemes and formations for Cardinals, Titans, Longhorns,
                    and Grizzlies with authentic branding and visual identity.
                </p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">🎯</div>
                <h3 class="feature-title">Dynamic Clustering</h3>
                <p class="feature-description">
                    Physics-based particle clustering with confidence-level visualization.
                    Real-time attraction forces and probability distribution mapping.
                </p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">📱</div>
                <h3 class="feature-title">Cross-Platform</h3>
                <p class="feature-description">
                    Responsive design with mobile optimization, VR/AR compatibility,
                    and progressive enhancement for all device types.
                </p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">⚡</div>
                <h3 class="feature-title">Real-Time Analytics</h3>
                <p class="feature-description">
                    Live integration with Monte Carlo simulations, instant distribution updates,
                    and smooth animated transitions between scenarios.
                </p>
            </div>

            <div class="feature-card">
                <div class="feature-icon">🎮</div>
                <h3 class="feature-title">Interactive Controls</h3>
                <p class="feature-description">
                    Keyboard shortcuts, camera presets, particle selection,
                    fullscreen mode, and screenshot capture functionality.
                </p>
            </div>
        </div>
    </div>

    <!-- Load Monte Carlo Engine -->
    <script src="monte-carlo-engine.js"></script>

    <!-- Load Enhanced Visualizer -->
    <script src="monte-carlo-visualizer-enhanced.js"></script>

    <script>
        // Demo application state
        const demoState = {
            currentTeam: 'cardinals',
            isSimulating: false,
            lastSimulationTime: 0,
            activeScenario: 'default'
        };

        // Initialize demo when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎲 Monte Carlo Demo Initializing...');

            initializeControls();
            setupStatusUpdates();

            // Wait for visualizer to initialize
            setTimeout(() => {
                updateStatusPanel();
                console.log('✅ Monte Carlo Demo Ready');
            }, 2000);
        });

        function initializeControls() {
            // Team selection buttons
            document.querySelectorAll('.team-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.team-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    const team = this.dataset.team;
                    demoState.currentTeam = team;

                    if (window.monteCarloVisualizer) {
                        window.monteCarloVisualizer.setColorScheme(team);
                        console.log(`Team changed to: ${team}`);
                    }

                    updateStatusPanel();
                });
            });

            // Particle count slider
            const particleSlider = document.getElementById('particleCount');
            const particleValue = document.getElementById('particleCountValue');

            particleSlider.addEventListener('input', function() {
                const count = parseInt(this.value);
                particleValue.textContent = count.toLocaleString();

                if (window.monteCarloVisualizer && !demoState.isSimulating) {
                    window.monteCarloVisualizer.setParticleCount(count);
                }
            });

            // Animation speed slider
            const speedSlider = document.getElementById('animationSpeed');
            const speedValue = document.getElementById('animationSpeedValue');

            speedSlider.addEventListener('input', function() {
                const speed = parseFloat(this.value);
                speedValue.textContent = speed + 'x';
                // Speed implementation would go here
            });

            // Simulation type selector
            document.getElementById('simulationType').addEventListener('change', function() {
                demoState.activeScenario = this.value;
                updateStatusPanel();
            });
        }

        function setupStatusUpdates() {
            // Update status panel every second
            setInterval(() => {
                if (window.monteCarloVisualizer) {
                    const visualizer = window.monteCarloVisualizer;

                    document.getElementById('currentFPS').textContent =
                        Math.round(visualizer.currentFPS || 0);

                    document.getElementById('activeParticles').textContent =
                        (visualizer.config.particleCount || 0).toLocaleString();

                    // Update memory usage (approximate)
                    if (performance.memory) {
                        const memoryMB = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
                        document.getElementById('metricMemoryUsage').textContent = memoryMB;
                    }
                }
            }, 1000);
        }

        function updateStatusPanel() {
            if (window.monteCarloVisualizer) {
                const visualizer = window.monteCarloVisualizer;

                document.getElementById('deviceTier').textContent =
                    visualizer.deviceCapabilities.tier.toUpperCase();

                document.getElementById('webgl2Support').textContent =
                    visualizer.deviceCapabilities.webgl2 ? 'Yes' : 'No';

                document.getElementById('currentTeam').textContent =
                    demoState.currentTeam.toUpperCase();

                document.getElementById('currentScenario').textContent =
                    demoState.activeScenario.charAt(0).toUpperCase() + demoState.activeScenario.slice(1);
            }
        }

        async function runSimulation() {
            if (demoState.isSimulating) return;

            demoState.isSimulating = true;
            const startTime = performance.now();

            const simulationType = document.getElementById('simulationType').value;
            const confidence = parseFloat(document.getElementById('confidenceLevel').value);

            console.log(`Running ${simulationType} simulation with ${confidence} confidence...`);

            try {
                let results;
                let data;

                if (window.monteCarloEngine) {
                    switch (simulationType) {
                        case 'season':
                            results = await window.monteCarloEngine.simulateSeasonTrajectory(
                                demoState.currentTeam, 30, { numSims: 5000 }
                            );
                            data = results.winDistribution;
                            break;

                        case 'game':
                            results = await window.monteCarloEngine.simulateGameOutcome(
                                demoState.currentTeam, 'opponent', { numSims: 10000, confidence }
                            );
                            data = results.marginDistribution;
                            break;

                        case 'player':
                            results = await window.monteCarloEngine.simulatePlayerPerformance(
                                'player123', 'batting', {
                                    numSims: 5000,
                                    baselineStats: { average: 0.275, consistency: 0.12 }
                                }
                            );
                            data = results.projections;
                            break;

                        case 'championship':
                            results = await window.monteCarloEngine.simulateChampionshipPath(
                                demoState.currentTeam, { numSims: 10000 }
                            );
                            data = results.paths.map(path => path.wonChampionship ? 1 : 0);
                            break;

                        default:
                            // Generate custom demo data
                            data = generateDemoData(1000);
                            break;
                    }
                } else {
                    // Fallback demo data if engine not available
                    data = generateDemoData(1000);
                }

                // Update visualizer
                if (window.monteCarloVisualizer && data) {
                    window.monteCarloVisualizer.updateDistribution(data, {
                        team: demoState.currentTeam,
                        scenario: simulationType,
                        smooth: true
                    });
                }

                const endTime = performance.now();
                demoState.lastSimulationTime = endTime - startTime;

                // Update metrics
                document.getElementById('metricProcessingTime').textContent =
                    Math.round(demoState.lastSimulationTime);

                document.getElementById('metricSimulations').textContent =
                    data ? data.length.toLocaleString() : '10,000';

                document.getElementById('metricConfidence').textContent =
                    Math.round(confidence * 100) + '%';

                console.log(`Simulation completed in ${Math.round(demoState.lastSimulationTime)}ms`);

            } catch (error) {
                console.error('Simulation error:', error);
            } finally {
                demoState.isSimulating = false;
            }
        }

        function generateDemoData(count) {
            const data = [];
            for (let i = 0; i < count; i++) {
                // Generate realistic probability distribution
                const base = Math.random();
                const gaussian = (Math.random() + Math.random() + Math.random()) / 3;
                data.push(base * gaussian * 100);
            }
            return data;
        }

        function toggleAutoRotate() {
            if (window.monteCarloVisualizer && window.monteCarloVisualizer.controls) {
                window.monteCarloVisualizer.toggleAutoRotate();
            }
        }

        function resetCamera() {
            if (window.monteCarloVisualizer) {
                window.monteCarloVisualizer.setCameraPreset('overview');
            }
        }

        function captureScreenshot() {
            if (window.monteCarloVisualizer) {
                window.monteCarloVisualizer.captureScreenshot();
            }
        }

        function exportData() {
            if (window.monteCarloVisualizer) {
                const data = window.monteCarloVisualizer.exportVisualizationData();

                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: 'application/json'
                });

                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `monte-carlo-data-${Date.now()}.json`;
                a.click();

                URL.revokeObjectURL(url);
                console.log('Data exported successfully');
            }
        }

        // Keyboard shortcuts for demo
        document.addEventListener('keydown', function(event) {
            if (event.target.tagName.toLowerCase() === 'input') return;

            switch (event.key.toLowerCase()) {
                case 's':
                    runSimulation();
                    break;
                case 'r':
                    resetCamera();
                    break;
                case 'e':
                    exportData();
                    break;
            }
        });

        // Performance monitoring
        let lastFrameTime = performance.now();
        let frameCount = 0;

        function monitorPerformance() {
            frameCount++;
            const currentTime = performance.now();

            if (currentTime - lastFrameTime >= 1000) {
                const fps = Math.round(frameCount * 1000 / (currentTime - lastFrameTime));

                // Update FPS display
                const fpsElement = document.getElementById('currentFPS');
                if (fpsElement) {
                    fpsElement.textContent = fps;

                    // Color code based on performance
                    if (fps >= 50) {
                        fpsElement.style.color = '#00FF88';
                    } else if (fps >= 30) {
                        fpsElement.style.color = '#FFAA00';
                    } else {
                        fpsElement.style.color = '#FF4488';
                    }
                }

                frameCount = 0;
                lastFrameTime = currentTime;
            }

            requestAnimationFrame(monitorPerformance);
        }

        // Start performance monitoring
        requestAnimationFrame(monitorPerformance);

        // Error handling
        window.addEventListener('error', function(event) {
            console.error('Demo error:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>